<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dev.workhiveback.mappers.LeaveMapper">
    <select id="selectCalendarData" resultType="com.dev.workhiveback.dtos.leave.CalendarDto">
        SELECT `o`.`index`        AS `index`,
               `t`.`display_text` AS `typeText`,
               `o`.`start_date`   AS `startDate`,
               `o`.`end_date`     AS `endDate`,
               'dayOffs'          AS `calendarType`
        FROM `wh`.`day_offs` AS `o`
                 LEFT JOIN `wh`.`day_offs_states` AS `s` ON `o`.`state` = `s`.`code`
                 LEFT JOIN `wh`.`day_offs_types` AS `t` ON `o`.`type` = `t`.`code`
        WHERE `o`.`requester_id` = #{empId} AND `s`.`code` = 3
    </select>

    <select id="selectLeaves" resultType="com.dev.workhiveback.entities.LeaveEntity">
        SELECT `index`        AS `index`,
               `requester_id` AS `requesterId`,
               `approver_id`  AS `approverId`,
               `state`        AS `state`,
               `type`         AS `type`,
               `request_date` AS `requestDate`,
               `approve_date` AS `approveDate`,
               `start_date`   AS `startDate`,
               `end_date`     AS `endDate`
        FROM `wh`.`day_offs`
        ORDER BY `index` DESC
    </select>

    <insert id="insertLeave">
        INSERT INTO `wh`.`day_offs` (`requester_id`, `approver_id`, `state`, `type`, `reason`, `request_date`, `approve_date`,
                                     `start_date`, `end_date`)
        VALUES (#{leave.requesterId}, #{leave.approverId}, #{leave.state}, #{leave.type}, #{leave.reason}, #{leave.requestDate},
                #{leave.approveDate}, #{leave.startDate}, #{leave.endDate})
    </insert>
</mapper>